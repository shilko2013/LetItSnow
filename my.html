<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Three.js lab</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<script src="js/three.js"></script>
<script src="js/GLTFLoader.js"></script>
<script src="js/OrbitControls.js"></script>
<script>
    var x_light = -500;
    var y_light = 0;

    var WIDTH = window.innerWidth;
    var HEIGHT = window.innerHeight;

    var renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.setSize(WIDTH, HEIGHT);
    renderer.setClearColor(0xDDDDDD, 1);
    document.body.appendChild(renderer.domElement);

    var scene = new THREE.Scene();

    var camera = new THREE.PerspectiveCamera(70, WIDTH / HEIGHT, 0.1, 10000);
    camera.position.z = 550;
    camera.position.y = 200;
    scene.add(camera);

    const loader = new THREE.GLTFLoader();


    loader.load(
        'models/fur_tree/scene.gltf',
        function (object) {
            var tree = object.scene;
            tree.traverse(function (node) {
                    node.castShadow = true;
            });
            tree.castShadow = true;
            scene.add(tree);
        },
        function (xhr) {
            console.log((xhr.loaded / xhr.total * 100) + '% loaded');
        },
        function (error) {
            console.error('An error happened' + error);
        }
    );

    var geo = new THREE.PlaneBufferGeometry(2000, 2000, 8, 8);
    const textureLoader = new THREE.TextureLoader();
    const material = new THREE.MeshBasicMaterial({
        map: textureLoader.load('textures/snow_ground.png'),
    });
    var plane = new THREE.Mesh(geo, material);
    plane.receiveShadow = true;
    plane.rotateX(-Math.PI / 2);
    scene.add(plane);

    const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.6);
    hemiLight.color.setHSL(0.6, 1, 0.6);
    hemiLight.groundColor.setHSL(0.095, 1, 0.75);
    hemiLight.position.set(-100, 500, 0);
    scene.add(hemiLight);

    const hemiLightHelper = new THREE.HemisphereLightHelper(hemiLight, 10);
    scene.add(hemiLightHelper);

    //

    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.color.setHSL(0.1, 1, 0.95);
    dirLight.position.set(-100, 500, 1);
    dirLight.lookAt(scene.position);
    scene.add(dirLight);

    dirLight.castShadow = true;

    dirLight.shadow.mapSize.width = 2048;
    dirLight.shadow.mapSize.height = 2048;
    dirLight.shadow.camera.near = 0.5;
    dirLight.shadow.camera.far = 5000;
    dirLight.shadow.camera.left = -500;
    dirLight.shadow.camera.bottom = -500;
    dirLight.shadow.camera.right = 500;
    dirLight.shadow.camera.top = 500;

    const helper = new THREE.CameraHelper(dirLight.shadow.camera);
    scene.add(helper);

    const dirLightHelper = new THREE.DirectionalLightHelper(dirLight, 10);
    scene.add(dirLightHelper);

    var clock = new THREE.Clock();
    var angle = 0;
    var angularSpeed = THREE.Math.degToRad(20);
    var delta = 0;
    var radius = 500;
    var direction = 1;

    function render() {
        requestAnimationFrame(render);

        // var delta = clock.getDelta();
        // light.position.set(0, Math.cos(angle) * radius, Math.sin(angle) * radius - 500);
        // angle += angularSpeed * delta;
        // light.target.position.set(0, 0, 0);
        // x_light += 1 * direction;

        renderer.render(scene, camera);
    }

    render();

    var controls = new THREE.OrbitControls(camera, renderer.domElement);
</script>
</body>
</html>